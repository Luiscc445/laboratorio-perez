{% extends "base_admin.html" %}
{% block title %}Gestión de Pacientes{% endblock %}
{% block content %}
<style>
    /* Eliminar padding superior del container */
    .container-fluid {
        padding: 0 !important;
        margin: 0 !important;
    }

    /* Header moderno estilo dashboard */
    .page-header {
        background: linear-gradient(135deg, #1ABC9C 0%, #16A085 100%);
        color: white;
        padding: 30px;
        border-radius: 0;
        margin: 0 0 30px 0;
        box-shadow: 0 10px 40px rgba(26, 188, 156, 0.3);
    }

    .page-header h1 {
        font-size: 2.5rem;
        font-weight: 800;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .page-header p {
        font-size: 1.1rem;
        opacity: 0.95;
        margin: 0;
    }

    .header-actions {
        display: flex;
        gap: 10px;
        margin-top: 20px;
    }

    .btn-header {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 2px solid rgba(255, 255, 255, 0.5);
        padding: 10px 25px;
        border-radius: 10px;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .btn-header:hover {
        background: white;
        color: #1ABC9C;
        border-color: white;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    /* Contenedor del contenido */
    .content-wrapper {
        padding: 0 30px 30px 30px;
    }

    .card {
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        border: none;
    }

    .card-header {
        background: linear-gradient(135deg, #3498DB, #2980B9);
        color: white;
        font-weight: 600;
        border-radius: 15px 15px 0 0 !important;
        padding: 15px 20px;
    }

    .table-responsive {
        border-radius: 0 0 15px 15px;
    }

    .btn-sm {
        padding: 5px 10px;
        border-radius: 5px;
        transition: all 0.3s ease;
    }

    .btn-sm:hover {
        transform: translateY(-2px);
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
    }
</style>

<div class="container-fluid">
    <!-- Header Moderno -->
    <div class="page-header">
        <h1>
            <i class="fas fa-users"></i>
            Gestión de Pacientes
        </h1>
        <p><i class="fas fa-list"></i> Total de pacientes registrados: {{ pacientes|length }}</p>
        <div class="header-actions">
            <button class="btn btn-header" data-bs-toggle="modal" data-bs-target="#modalNuevo">
                <i class="fas fa-plus"></i> Nuevo Paciente
            </button>
        </div>
    </div>

    <!-- Contenedor del contenido -->
    <div class="content-wrapper">
        <div class="card">
            <div class="card-header"><i class="fas fa-list"></i> Lista de Pacientes ({{ pacientes|length }})</div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr><th>ID</th><th>Nombre Completo</th><th>CI</th><th>Teléfono</th><th>Email</th><th>Fecha Registro</th><th>Acciones</th></tr>
                        </thead>
                        <tbody>
                            {% for p in pacientes %}
                            <tr>
                                <td><b>{{ p.id }}</b></td>
                                <td>{{ p.nombre }}</td>
                                <td>{{ p.ci }}</td>
                                <td>{{ p.telefono or '-' }}</td>
                                <td>{{ p.email or '-' }}</td>
                                <td>{{ p.fecha_registro.strftime('%d/%m/%Y') }}</td>
                                <td>
                                    <button class="btn btn-sm btn-info btn-ver"
                                            data-id="{{ p.id }}"
                                            title="Ver detalles">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-warning btn-editar"
                                            data-id="{{ p.id }}"
                                            data-nombre="{{ p.nombre }}"
                                            data-ci="{{ p.ci }}"
                                            data-telefono="{{ p.telefono or '' }}"
                                            data-email="{{ p.email or '' }}"
                                            title="Editar">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger btn-eliminar"
                                            data-id="{{ p.id }}"
                                            data-nombre="{{ p.nombre }}"
                                            title="Eliminar">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </td>
                            </tr>
                            {% else %}
                            <tr><td colspan="7" class="text-center text-muted py-4"><i class="fas fa-inbox fa-3x mb-3"></i><p>No hay pacientes</p></td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- MODAL NUEVO -->
<div class="modal fade" id="modalNuevo" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #1ABC9C, #16A085); color: white;">
                <h5><i class="fas fa-user-plus"></i> Registrar Nuevo Paciente</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST">
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label"><i class="fas fa-user"></i> Nombre Completo</label>
                        <input type="text" class="form-control" name="nombre" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label"><i class="fas fa-id-card"></i> CI</label>
                        <input type="text" class="form-control" name="ci" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label"><i class="fas fa-phone"></i> Teléfono</label>
                        <input type="text" class="form-control" name="telefono">
                    </div>
                    <div class="mb-3">
                        <label class="form-label"><i class="fas fa-envelope"></i> Email</label>
                        <input type="email" class="form-control" name="email">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="fas fa-times"></i> Cancelar</button>
                    <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Guardar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- MODAL VER DETALLES -->
<div class="modal fade" id="modalVer" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #3498DB, #2980B9); color: white;">
                <h5><i class="fas fa-info-circle"></i> Información del Paciente</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="card border-0 shadow-sm mb-3">
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-4"><strong><i class="fas fa-hashtag text-primary"></i> ID:</strong></div>
                            <div class="col-8" id="verID">-</div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-4"><strong><i class="fas fa-user text-success"></i> Nombre:</strong></div>
                            <div class="col-8" id="verNombre">-</div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-4"><strong><i class="fas fa-id-card text-warning"></i> CI:</strong></div>
                            <div class="col-8" id="verCI">-</div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-4"><strong><i class="fas fa-phone text-info"></i> Teléfono:</strong></div>
                            <div class="col-8" id="verTelefono">-</div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-4"><strong><i class="fas fa-envelope text-danger"></i> Email:</strong></div>
                            <div class="col-8" id="verEmail">-</div>
                        </div>
                        <div class="row">
                            <div class="col-4"><strong><i class="fas fa-calendar text-secondary"></i> Registro:</strong></div>
                            <div class="col-8" id="verFecha">-</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="fas fa-times"></i> Cerrar</button>
            </div>
        </div>
    </div>
</div>

<!-- MODAL EDITAR -->
<div class="modal fade" id="modalEditar" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #F39C12, #E67E22); color: white;">
                <h5><i class="fas fa-edit"></i> Editar Paciente</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" id="formEditar">
                <div class="modal-body">
                    <input type="hidden" name="paciente_id" id="editID">
                    <div class="mb-3">
                        <label class="form-label"><i class="fas fa-user"></i> Nombre Completo</label>
                        <input type="text" class="form-control" name="nombre" id="editNombre" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label"><i class="fas fa-id-card"></i> CI</label>
                        <input type="text" class="form-control" name="ci" id="editCI" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label"><i class="fas fa-phone"></i> Teléfono</label>
                        <input type="text" class="form-control" name="telefono" id="editTelefono">
                    </div>
                    <div class="mb-3">
                        <label class="form-label"><i class="fas fa-envelope"></i> Email</label>
                        <input type="email" class="form-control" name="email" id="editEmail">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="fas fa-times"></i> Cancelar</button>
                    <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- MODAL ELIMINAR -->
<div class="modal fade" id="modalEliminar" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #E74C3C, #C0392B); color: white;">
                <h5><i class="fas fa-exclamation-triangle"></i> Confirmar Eliminación</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" id="formEliminar">
                <div class="modal-body">
                    <div class="alert alert-danger mb-3">
                        <i class="fas fa-exclamation-circle"></i> <strong>¡ADVERTENCIA!</strong><br>
                        Esta acción es <strong>IRREVERSIBLE</strong> y eliminará:
                    </div>
                    <ul class="mb-3">
                        <li><i class="fas fa-user text-danger"></i> El paciente: <strong id="eliminarNombre"></strong></li>
                        <li><i class="fas fa-file-pdf text-danger"></i> Todos sus resultados y archivos PDF asociados</li>
                        <li><i class="fas fa-database text-danger"></i> Todos los registros de la base de datos</li>
                    </ul>
                    <div class="card border-warning bg-light">
                        <div class="card-body">
                            <p class="mb-0"><i class="fas fa-info-circle text-warning"></i> <strong>¿Está seguro de continuar?</strong></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash-alt"></i> Sí, Eliminar
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Lógica de pacientes -->
<script src="{{ url_for('static', filename='js/admin/pacientes.js') }}"></script>
{% endblock %}